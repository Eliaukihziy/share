# 代码解读

## 影响代码性能的因素

1. 在文件处理函数中并没有降低速度

2. 影响因素候选：***主要***

## transE 训练

### 文件操作函数

1. 文件路径无误后，使用strip移除字符串头尾指定字符，并使用split进行切片。

2. 将子字符串存入字典（键值对），实体/关系为key，ID为值。

3. 将测试集所有的三元组以ID号形式存入三维列表，实体（14万+）和关系（1300+）可以全匹配测试集数据。

### 算法实现

#### 初始化

1. 维度-50，学习率-0.01，上界-1，L1-正则化。

2. 实体和关系以ID为编号进行随机均匀向量化，并进行归一化。

#### 训练

1. 166行，集合entity使用keys()访问数据，不理解，keys是字典操作方法，访问了ID号，这里的传入的是ID集合，在这个操作中变成了字典.***更正：在120行将归一化后的字典覆盖了集合***

2. 两次更新：update_embeddings函数中，要对correct triplet和corrupted triplet都进行更新。虽然写作$(h,l,t)$和$(h',l,t')$，但两个三元组只有一个entity不同（前面说了，不同时替换头尾实体），所以在每步更新时重叠的实体要更新两次（和更新relation一样），否则就会导致后一次更新覆盖前一次。***255行，损失更新还待理解，238行，向量乘2不明白,267行，关系更新。***

## test 测试

### main函数

1. train.py文件处理函数

2. 新定义的测试文件处理函数

3. 调用测试类

4. 调用排名计算函数

### dataloader 新定义的文件处理函数

1. 先处理训练生成的实体和关系向量，生成字典，再将要测试的数据集生成三元组(ID)列表。

### rank函数 头尾排名计算

1. 实体排名计算

>* 在测试集实体集合中利用ID匹配，分为两种方式，剔除训练集中已经存在的负样本三元组，但是这样需要遍历以便三元组，效率降低（一个思考：使用iteration函数会不会加速遍历操作）。头尾实体一次进行如上操作。

### relation_rank函数

1. 将测试集的关系被训练集的关系替换，遍历一次，根据距离计算排名，然后计算预测效果。-+
